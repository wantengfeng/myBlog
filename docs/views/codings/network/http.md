---
title: http版本演化
date: '2022-7-4'
---
:::tip
Http是很常用的应用层协议，它有不同的版本，这里总结下
:::

## http/0.9
- 只有get命令，例如GET /index.html，服务端只能回应html格式的网页，不能回复别的格式
## http/1.0
- 不仅可以传输文字，还可以传输图像，视频，二进制文件
- 除了get命令，还引入了post和head命令
- 请求和响应的格式变了，引入头信息（Http Header），用来描述一些元数据
- 引入状态码（status code）、多字符集支持、多部分发送（multi-part type）、权限（authorization）、缓存（cache）、内容编码（content encoding）等  
###缺点
- 每个Tcp连接只能发送一个请求，发送完毕，连接断开。
###优化方法  
- 浏览器和服务器使用非标准的Connection: keep-alive字段（请求和响应都带上），要求服务器不要关闭Tcp连接，以便复用，
直到客户端和服务端主动关闭连接。但是这不是标准字段，不用实现的行为可能不一样
##Http/1.1(主流使用)
- 引入持久连接，即Tcp连接默认不关闭，可以复用，不用声明Connection: keep-alive，客户端和服务端发现对方一段时间
没有活动，就可以主动关闭连接，规范做法是客户端在最后一个请求时，发送Connection: close。用一个域名，大多数浏览器
允许同时建立6个连接
- 引入管道机制(pipelining)，在同一个Tcp连接中，客户端可以同时发送多个请求，之前强制一问一答。客户端同时发送A请求
和B请求，服务端会按照顺序，先回应A请求，完成之后再回应B请求。
- 同一个Tcp请求可以传送多个回应，所以引入Content-length字段声明本次回应的数据长度，后面的字节就属于下一个回应。
- 分块传输。使用Content-length前提是，服务器发送数据之前，知道回应的数据长度。这意味这服务器要等到所有操作完成，
才能发送数据，效率不高。更好的方式，产生一块数据，就发送一块，采用流模式（stream）取代缓存模式（buffer）。这时，
可以不使用Content-length字段，使用Transfer-encoding字段，表明回应将有数量未定的数据块组成。
```http request
HTTP/1.1 200 OK
Content-Type: text/plain
// 采用流模式
Transfer-Encoding: chunked

25 //十六进制表示这个块大小
This is the data in the first chunk

1C
and this is the second one

3
con

8
sequence

0
```
- 新增put，patch，head，options，delete方法
- 客户端头信息新增host字段，用来指定服务器的域名。有了host字段，可以将请求发往同一台服务器上的不用网站，为虚拟主机打下基础
###缺点
- 虽然1.1版本可以复用Tcp连接，但是同一个Tcp连接，所有的数据通信按照次序进行，要是前面回应的慢，后面就会有很多请求排队等待，
称为队头阻塞（head-of-line blocking）
###优化方法
- 减少请求数
- 同时多开持久连接
##Http/2
- 二进制协议。Http/1.1版本的头信息是文本（ASCII编码），数据体可以是文本，也可以是二进制。Http/2则是一个彻底的二进制协议，
头信息和数据体都是二进制，并且统称为帧（frame）：头信息帧和数据帧。Http/2定义了近十种帧，为将来高级应用打好了基础。
- 多工。Http/2复用tcp连接，在一个连接中，客户端和服务器可以同时发送多个请求和响应，并且不用按照顺序一一对应，避免队头阻塞。
例如，在一个Tcp连接中，服务器同时收到A请求和B请求，于是先回应A请求，结果发现处理过程非常耗时，于是就发送A请求已经处理好的部分，
接着回应B请求，完成后，再发送A请求剩余的部门。这种双向的、实时的通信，叫做多工（Multiplexing）
- 数据流。Http/2的数据包不按照顺序发送，同一个连接里面连续的数据包，可能属于不同的回应。需要对数据标记，指出它属于哪个回应。
Http2将每个请求或者响应的所有数据包，称为一个数据流（Stream）。每个数据流都有一个独一无二的编号。规定客户端发送的数据流为奇数，
服务端为偶数。数据流发送一半时，客户端和服务端可以发送信号（RST_STREAM帧）,取消这个数据流。Http/1.1取消数据流的唯一办法就是
关闭连接，Http/2在保持Tcp连接还打开的情况下，取消某一次请求。客户端还可以执行数据流的优先级，优先级越高，服务器越早回应。
- 头信息压缩。Http协议不带状态，每个请求都必须附上所有信息，但是很多字段都是重复的，比如Cookie和User Agent，浪费带宽，影响速度。
Http/2引入头信息压缩机制，一方面，头信息使用gzip或compress压缩后再发送；另一方面，客户端和服务端同时维护一张头信息表，所有字段都
保存到这个表中，生成一个索引号，以后只需要发索引号就可以了。
- 服务器推送。Http/2允许服务器非经请求，主动向客户端发送资源。常见场景是客户端请求一个网页，收到网页，解析Html源码，发现有静态资源，
再发出静态资源请求。其实，服务器可以预期这些请求，主动把这些静态资源随网页一起发给客户端。
##参考  
[HTTP协议入门](http://www.ruanyifeng.com/blog/2016/08/http.html)


